<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Matrix Solutions Network â€” Digital ID</title>

  <!-- Share Tech Mono (dashboard font) -->
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- CSV -->
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- Chart.js (+labels) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

  <!-- Turf + polylabel for robust centroids -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <script src="https://unpkg.com/polylabel@1.1.0/polylabel.js"></script>

  <style>
    :root{
      --bg:#07100b;
      --text:#ffffff;
      --chip:#061c13; --chipEdge:#10402b;
      --panel:#06130d; --panelEdge:#0b2a1c;
      --orange:#ff9900;
      --red:#ff3333;
      --mint:#7be2b1;
      --matrix:#21ff9d;
      --barH:72px;
    }
    html,body{
      height:100%;
      margin:0;
      background:radial-gradient(1200px 600px at 20% -10%, #0d1f16 0%, #07100b 45%, #06140e 100%);
      color:var(--text);
      font-family:"Share Tech Mono",ui-monospace,monospace;
    }

    /* ===== Top bar ===== */
    #topbar{
      position:fixed; z-index:1100; left:0; right:0; top:0;
      display:flex; align-items:center; gap:12px; flex-wrap:wrap;
      background:linear-gradient(180deg,rgba(10,30,20,.86),rgba(8,22,16,.98));
      border-bottom:1px solid var(--panelEdge);
      padding:12px 14px;
      min-height:var(--barH);
      box-shadow:0 10px 28px rgba(0,0,0,.45);
      backdrop-filter: blur(2px);
    }
    #brandTitle{display:flex; align-items:center; gap:10px; white-space:nowrap}
    #brandTitle h1{margin:0; font-size:18px; letter-spacing:.4px;}
    #brandTitle .msn{color:var(--matrix)}
    #brandTitle .sep{opacity:.6; margin:0 6px; color:#c3ffe6}
    #brandTitle .page{color:#ffffff}

    .live{font-size:11px;color:#ffffff;background:var(--red);
      padding:3px 8px;border-radius:999px;border:1px solid #ff6b6b}
    .updated{margin-left:8px; font-size:12px; color:#ffffff; opacity:.9}
    .inline-hint{margin-left:10px; font-size:12px; opacity:.8}

    .actions{
      margin-left:auto; display:flex; gap:8px; overflow:auto hidden;
      scrollbar-width:none;
    }
    .actions::-webkit-scrollbar{display:none}
    .btn{
      background:#062015; border:1px solid #1b5a3e; color:#ffffff;
      padding:8px 10px; border-radius:10px; text-decoration:none;
      white-space:nowrap; font-weight:700; letter-spacing:.3px; font-size:13px;
    }
    .btn:hover{box-shadow:0 0 18px rgba(33,255,157,.20)}

    /* ===== Map ===== */
    #map{
      position:absolute; left:0; right:0; top:var(--barH); bottom:0;
    }
    .leaflet-tile { filter: brightness(1.08) contrast(1.08) saturate(0.95); }
    .leaflet-top{ top:14px; }
    .leaflet-control-zoom{ margin-top:6px; }

    /* ===== Stats opener chip ===== */
    #fab{
      position:absolute; left:50%; transform:translateX(-50%);
      top:calc(var(--barH) + 10px); z-index:1002;
      display:inline-flex; align-items:center; gap:10px;
      background:var(--chip); border:1px solid var(--chipEdge); color:var(--text);
      border-radius:999px; padding:8px 12px; cursor:pointer;
      font-weight:700; white-space:nowrap;
      box-shadow:0 6px 18px rgba(0,0,0,.45); user-select:none;
    }

    /* ===== Drawer ===== */
    #drawer{
      position:absolute; left:12px; bottom:56px; z-index:1001;
      width:360px; max-width:92vw; max-height:66vh; overflow:auto;
      background:linear-gradient(180deg,rgba(10,30,20,.94),rgba(8,22,16,.96));
      border:1px solid var(--panelEdge); border-radius:12px;
      padding:12px; display:none; box-shadow:0 10px 28px rgba(0,0,0,.55);
      backdrop-filter: blur(1px);
      color:#ffffff;
    }
    #drawer.open{ display:block }
    .drawer-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; position:sticky; top:0; background:inherit; padding-bottom:6px; }
    .drawer-title{ font-weight:800; letter-spacing:.4px; text-align:center; margin:0 auto; }
    .icon-btn{
      width:26px;height:26px;border-radius:8px;border:1px solid #1b5a3e;
      background:#062015; color:#ffffff; font-size:14px; line-height:24px;
      display:inline-flex; align-items:center; justify-content:center;
      cursor:pointer; padding:0; font-weight:800;
    }
    .row{display:flex;align-items:center;gap:8px;margin:6px 0;}
    .sw{width:12px;height:12px;border-radius:50%}
    .count{margin-left:auto;color:#ffffff;font-weight:700}
    .hr{border:none;border-top:1px solid #0f3524;margin:8px 0}
    .hint{font-size:12px;color:#ffffff;opacity:.8}
    .debug{margin-top:8px;max-height:120px;overflow:auto;font-size:12px;color:#ffffff;display:none}

    .leaflet-popup-content-wrapper{background:#0a1c14;color:#ffffff;border:1px solid #174d35;}
    .leaflet-popup-tip{background:#0a1c14;border:1px solid #174d35;}
    .leaflet-tooltip{background:#0a1c14;color:#ffffff;border:1px solid #174d35;}

    .textfield, .select, .num {
      background:#062015;border:1px solid #1b5a3e;border-radius:8px;color:#ffffff;
      padding:6px 8px;font:700 13px "Share Tech Mono",ui-monospace; outline:none; width:100%;
    }
    .btn-ghost {
      background:#062015;border:1px solid #1b5a3e;border-radius:8px;color:#ffffff;
      padding:6px 10px;font:700 13px "Share Tech Mono",ui-monospace; cursor:pointer;
    }

    /* Mobile */
    @media (max-width: 720px){
      #brandTitle { width:100%; }
      #brandTitle h1 { font-size:16px; }
      .actions{gap:6px}
      .btn{padding:7px 9px;font-size:12px}
      #drawer{
        left:10px; right:10px; bottom:66px;
        width:auto; max-width:calc(100vw - 20px);
        max-height:58vh; border-radius:12px;
      }
      #fab{ top:calc(var(--barH) + 8px); padding:7px 10px; font-size:12px; }
    }
