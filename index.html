<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Matrix Solutions Network — Agenda Tracker</title>

<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  :root{
    --bg:#07100b;
    --panel:#06130d;
    --panelEdge:#0b2a1c;
    --text:#b8ffd8;
    --muted:#6cd7a3;
    --glow:#21ff9d;
    --red:#ff3333;       /* Implemented */
    --orange:#ff9900;    /* In development */
    --gap:16px;
    --round:18px;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:"Share Tech Mono",ui-monospace,monospace;}
  *{box-sizing:border-box}

  .wrap{max-width:1280px;margin:32px auto;padding:0 18px}
  .bar{display:flex;align-items:center;gap:10px;margin-bottom:14px;flex-wrap:wrap}
  .dot{width:14px;height:14px;border-radius:50%;background:radial-gradient(circle at 40% 40%,#6cffbf,var(--glow));box-shadow:0 0 10px var(--glow),0 0 24px rgba(33,255,157,.55)}
  h1{font-size:28px;margin:0;letter-spacing:1px}
  .sub{color:var(--muted);opacity:.85;font-size:14px}
  .sub a{color:var(--glow);text-decoration:none}
  .sub a:hover{text-decoration:underline}

  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
  .card{
    position:relative;display:flex;flex-direction:column;
    background:linear-gradient(180deg,rgba(10,30,20,.66),rgba(8,22,16,.92));
    border:1px solid var(--panelEdge);border-radius:var(--round);
    box-shadow:0 14px 36px rgba(0,0,0,.45);
    padding:18px;
  }
  .titleRow{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:8px;position:relative}
  .live{font-size:12px;color:#062715;background:var(--glow);padding:3px 8px;border-radius:999px;border:1px solid #74ffc7}
  .card h2{
    margin:0;text-align:center;line-height:1.2;
    font-size:20px;
  }

  /* Chart area stays square, never stretched */
  .chartBox{
    width:100%;
    aspect-ratio:1/1;   /* square on all screens */
    display:flex;align-items:center;justify-content:center;
    padding:10px 6px 0;
  }
  .chartBox canvas{width:100% !important;height:100% !important}

  /* Stats block sits above the button, spacing is consistent */
  .stats{display:flex;flex-direction:column;gap:10px;margin-top:auto;margin-bottom:var(--gap)}
  .stat{
    display:flex;align-items:center;justify-content:space-between;
    border:1px solid var(--panelEdge);border-radius:12px;padding:10px 12px;
    background:#061c13;
  }
  .stat label{opacity:.9}
  .stat .val{font-weight:700;color:var(--glow)}

  .btn{
    display:block;width:100%;text-align:center;padding:12px 0;
    border:1px solid #1b5a3e;border-radius:12px;background:#062015;
    color:var(--glow);text-decoration:none;font-weight:700;letter-spacing:.5px;
    box-shadow:0 0 0 0 rgba(33,255,157,.0); transition:box-shadow .15s ease, transform .04s ease;
  }
  .btn:hover{box-shadow:0 0 22px rgba(33,255,157,.22)}
  .btn:active{transform:translateY(1px)}

  .hint{margin-top:16px;color:var(--muted);font-size:12px}

  /* --- Mobile tweaks --- */
  @media (max-width: 1020px){
    .grid{grid-template-columns:1fr;gap:22px}
    h1{font-size:24px}
    .dot{width:16px;height:16px} /* bigger and not cut off */
    .sub{line-height:1.4}
    .card h2{font-size:18px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <span class="dot" aria-hidden="true"></span>
      <h1>Matrix Solutions Network — Agenda Tracker</h1>
    </div>
    <div class="sub">
      Live overview • Implemented vs In development •
      <a href="https://www.notion.so/Matrix-Solutions-Network-Dashboard-264f848a73ef8089a7edf4149ea664a5?source=copy_link" target="_blank" rel="noopener">Click here to open the Matrix Solutions Network Dashboard ↗</a>
    </div>

    <div class="grid" id="grid">
      <!-- Digital ID -->
      <section class="card">
        <div class="titleRow">
          <h2>Digital ID Updates</h2>
          <span class="live">LIVE</span>
        </div>
        <div class="chartBox"><canvas id="c1"></canvas></div>

        <div class="stats">
          <div class="stat"><label>Implemented</label><span class="val" id="c1-imp">0</span></div>
          <div class="stat"><label>In development</label><span class="val" id="c1-dev">0</span></div>
          <div class="stat"><label>Total countries logged</label><span class="val" id="c1-total">0</span></div>
        </div>

        <a class="btn" href="./digital-id/" target="_blank" rel="noopener">View Live Map</a>
      </section>

      <!-- CBDC -->
      <section class="card">
        <div class="titleRow">
          <h2>Central Bank Digital Currency (CBDC) Updates</h2>
          <span class="live">LIVE</span>
        </div>
        <div class="chartBox"><canvas id="c2"></canvas></div>

        <div class="stats">
          <div class="stat"><label>Implemented</label><span class="val" id="c2-imp">0</span></div>
          <div class="stat"><label>In development</label><span class="val" id="c2-dev">0</span></div>
          <div class="stat"><label>Total countries logged</label><span class="val" id="c2-total">0</span></div>
        </div>

        <a class="btn" href="./cbdc/" target="_blank" rel="noopener">View Live Map</a>
      </section>

      <!-- SCS -->
      <section class="card">
        <div class="titleRow">
          <h2>Social Credit System Updates</h2>
          <span class="live">LIVE</span>
        </div>
        <div class="chartBox"><canvas id="c3"></canvas></div>

        <div class="stats">
          <div class="stat"><label>Implemented</label><span class="val" id="c3-imp">0</span></div>
          <div class="stat"><label>In development</label><span class="val" id="c3-dev">0</span></div>
          <div class="stat"><label>Total countries logged</label><span class="val" id="c3-total">0</span></div>
        </div>

        <a class="btn" href="./social-credit-system/" target="_blank" rel="noopener">View Live Map</a>
      </section>
    </div>

    <div class="hint">
      Stats auto-refresh on reload. “In discussion” rows are ignored here to keep the overview clean.
    </div>
  </div>

<script>
  // ====== LINKS (use the same CSVs you’ve been using) ======
  const LINK_ID   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsoZwmLz701G4Q5zFjGsL_RO8yjfxe4jY0woh-YL_-ATX6Mc4Rzxf3cSP7LzLN9OCt5Is_s1FHHAWs/pub?gid=0&single=true&output=csv";
  const LINK_CBDC = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsoZwmLz701G4Q5zFjGsL_RO8yjfxe4jY0woh-YL_-ATX6Mc4Rzxf3cSP7LzLN9OCt5Is_s1FHHAWs/pub?gid=1527883493&single=true&output=csv";
  const LINK_SCS  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsoZwmLz701G4Q5zFjGsL_RO8yjfxe4jY0woh-YL_-ATX6Mc4Rzxf3cSP7LzLN9OCt5Is_s1FHHAWs/pub?gid=1564220601&single=true&output=csv";

  const COLOR_IMPLEMENTED = getCSS('--red');
  const COLOR_DEVELOPMENT = getCSS('--orange');

  function getCSS(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

  function fetchCsv(url){
    return fetch(url + (url.includes('?')?'&':'?')+'cb='+Date.now(), {cache:'no-store'})
      .then(r=>r.text())
      .then(t=>Papa.parse(t,{header:true,skipEmptyLines:true}).data);
  }

  // Count helper: implemented vs in-dev; ignore "discussion" for the index
  function summarize(rows){
    let imp=0, dev=0;
    for(const row of rows){
      const s = String(row.Status||row.status||"").toLowerCase();
      if(!s) continue;
      if(/implement/.test(s)) imp++;
      else if(/develop|pilot|trial|poc|proof|concept/.test(s)) dev++;
      // ignore 'discussion'
    }
    return {imp, dev, total: imp+dev};
  }

  // Build a labeled pie (with label text inside each slice)
  function pie(canvasId, imp, dev){
    const total = Math.max(1, imp+dev);
    const el = document.getElementById(canvasId);
    Chart.register(ChartDataLabels);
    return new Chart(el, {
      type:'pie',
      data:{
        labels:['Implemented','In development'],
        datasets:[{
          data:[imp, dev],
          backgroundColor:[COLOR_IMPLEMENTED, COLOR_DEVELOPMENT],
          borderColor:'rgba(0,0,0,.5)', borderWidth:1
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:true,
        aspectRatio:1,           // square; prevents stretch on mobile
        layout:{padding:4},
        plugins:{
          legend:{ display:false },
          datalabels:{
            color:'#08150F',
            font:{weight:'700', size:12},
            formatter:(v,ctx)=>{
              const lbl = ctx.chart.data.labels[ctx.dataIndex];
              const pct = Math.round((v/total)*100);
              return `${lbl}\n${v} (${pct}%)`;
            }
          },
          tooltip:{enabled:true}
        }
      }
    });
  }

  async function init(){
    try{
      const [idRows, cbdcRows, scsRows] = await Promise.all([
        fetchCsv(LINK_ID), fetchCsv(LINK_CBDC), fetchCsv(LINK_SCS)
      ]);

      const A = summarize(idRows);
      const B = summarize(cbdcRows);
      const C = summarize(scsRows);

      // Update counters
      setNums('c1', A); setNums('c2', B); setNums('c3', C);

      // Charts
      pie('c1', A.imp, A.dev);
      pie('c2', B.imp, B.dev);
      pie('c3', C.imp, C.dev);

    }catch(e){
      console.error(e);
    }
  }

  function setNums(prefix, {imp,dev,total}){
    document.getElementById(prefix+'-imp').textContent   = imp;
    document.getElementById(prefix+'-dev').textContent   = dev;
    document.getElementById(prefix+'-total').textContent = total;
  }

  init();
</script>
</body>
</html>
